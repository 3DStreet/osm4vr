<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fly through a city</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="geojson.js"></script>
  <script src="log2hud.js"></script>
  <script src="birdman.js"></script>
  <script src="wing.js"></script>
</head>
<body>
  <!-- HTML button to control flying in non-VR mode -->
  <button id="fbtn" style="z-index: 999; position: relative">Flap</button>

  <a-scene>
    <a-assets>
      <img id="skyTexture" crossorigin="anonymous" src="https://cdn.aframe.io/a-painter/images/sky.jpg">
      <a-asset-item id="json-world" src="kappel.geojson" />
    </a-assets>

    <!-- The rig contains the camera and can move around, we start a bit back from centre -->
    <a-entity id="rig" position="0 0 2" rotation="0 0 0">
      <!-- Camera position and rotation in the rig get overwritten by the actual VR head-set, starting at default height 1.6m -->
      <a-entity id="head" camera look-controls wasd-controls birdman log2hud="target: chud" position="0 1.6 0">
        <!-- "Head up displays" to show live data for camera and left/right hand controller -->
        <a-entity id="lhud" position="0.5 0 -2" scale="2 2 1"></a-entity>
        <a-entity id="chud" position="1 0.5 -2" scale="2 2 1"></a-entity>
        <a-entity id="rhud" position="1.5 0 -2" scale="2 2 1"></a-entity>
      </a-entity>
      
      <!-- The actual left and right hand controllers -->
      <a-entity id="leftHand" laser-controls="hand: left" wing log2hud="target: lhud"></a-entity>
      <a-entity id="rightHand" laser-controls="hand: right" wing log2hud="target: rhud"></a-entity>
    </a-entity>

    <a-sky id="background" src="#skyTexture" theta-length="90"></a-sky>
    <a-plane color="#33aa66" height="1000" width="1000" rotation="-90 0 0" shadow="receive: true"></a-plane>
    <a-entity geojson="src: #json-world;"></a-entity>
  </a-scene>

  <!-- Some javascript to interact with the scene and its contents -->
  <script>
    const rig = document.getElementById('rig');
    const head = document.getElementById('head');
    const VAXIS = new THREE.Vector3(0, 1, 0);
    
    document.getElementById("fbtn").addEventListener('click', e => {
      rig.object3D.position.y += 5;
      head.components.birdman.dir.z = -0.1;
      head.components.birdman.dir.applyAxisAngle(VAXIS, head.object3D.rotation.y);
    });
  </script>
</body>
</html>